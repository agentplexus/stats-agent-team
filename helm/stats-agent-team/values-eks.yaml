# Values for AWS EKS production deployment
# Usage: helm install stats-agent ./helm/stats-agent-team -f ./helm/stats-agent-team/values-eks.yaml

global:
  image:
    # Default: GitHub Container Registry (public, no auth required)
    # For ECR: "123456789012.dkr.ecr.us-west-2.amazonaws.com"
    registry: "ghcr.io/agentplexus"
    pullPolicy: Always
    tag: "latest"

  # Image pull secrets (not needed for ghcr.io public images)
  # For private ECR: kubectl create secret docker-registry ecr-creds ...
  imagePullSecrets: []
    # - name: ecr-creds

# Namespace
namespace:
  create: true
  name: stats-agent

# LLM Configuration
llm:
  provider: gemini
  geminiModel: "gemini-2.0-flash-exp"

# Search Configuration
search:
  provider: serper

# Use external secrets management (AWS Secrets Manager via External Secrets Operator)
secrets:
  create: false  # Use external secrets instead

# Production resource allocations
research:
  enabled: true
  replicaCount: 2
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 512Mi
  # Spread across availability zones
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: research
            topologyKey: topology.kubernetes.io/zone

synthesis:
  enabled: true
  replicaCount: 2
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 1Gi
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: synthesis
            topologyKey: topology.kubernetes.io/zone

verification:
  enabled: true
  replicaCount: 2
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 1Gi
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: verification
            topologyKey: topology.kubernetes.io/zone

orchestration:
  enabled: true
  replicaCount: 2
  useEino: true
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 1Gi
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: orchestration
            topologyKey: topology.kubernetes.io/zone

direct:
  enabled: true
  replicaCount: 2
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 1Gi

# AWS ALB Ingress
ingress:
  enabled: true
  className: alb
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "30"
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: "5"
    alb.ingress.kubernetes.io/healthy-threshold-count: "2"
    alb.ingress.kubernetes.io/unhealthy-threshold-count: "3"
    # Enable HTTPS (uncomment and configure)
    # alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS":443}]'
    # alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:region:account:certificate/cert-id

  host: ""  # Set your domain, e.g., "stats-agent.example.com"

  # TLS configuration (uncomment for HTTPS)
  # tls:
  #   - secretName: stats-agent-tls
  #     hosts:
  #       - stats-agent.example.com

# Service Account with IRSA (IAM Roles for Service Accounts)
serviceAccount:
  create: true
  annotations:
    # Uncomment and set your IAM role ARN for AWS Secrets Manager access
    # eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/stats-agent-role
  name: stats-agent

# Production security settings
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL
